import S3 from 'aws-sdk/clients/s3';
import { GetStaticProps } from 'next';
import Head from 'next/head';
import { useCallback, useRef, useState, useEffect } from 'react';
import Edit from '../components/edit';
import { ErrorDialog } from '../components/error';
import { ShareLinkDialog } from '../components/home/ShareLinkDialog';
import Malleable, { FieldEdit } from '../components/malleable';
import Snapshot from '../components/snapshot';
import { useScrollReset } from '../hooks/use-scroll-reset';
import layoutStyles from '../styles/layout.module.css';
import Image from 'next/image';
import { AutoScaling } from 'aws-sdk';

// Next.js automatically eliminates code used for `getStaticProps`!
// This code (and the `aws-sdk` import) will be absent from the final client-
// side JavaScript bundle(s).
const s3 = new S3({
  credentials: {
    accessKeyId: process.env.AWS_S3_ACCESS_KEY_ID,
    secretAccessKey: process.env.AWS_S3_SECRET_ACCESS_KEY,
  },
});

export const getStaticProps: GetStaticProps = async ({
  // `preview` is a Boolean, specifying whether or not the application is in
  // "Preview Mode":
  preview,
  // `previewData` is only set when `preview` is `true`, and contains whatever
  // user-specific data was set in `res.setPreviewData`. See the API endpoint
  // that enters "Preview Mode" for more info (api/share/[snapshotId].tsx).
  previewData,
}) => {
  if (preview) {
    const { snapshotId } = previewData as { snapshotId: string };
    try {
      // In preview mode, we want to access the stored data from AWS S3.
      // Imagine using this to fetch draft CMS state, etc.
      const object = await s3
        .getObject({
          Bucket: process.env.AWS_S3_BUCKET,
          Key: `${snapshotId}.json`,
        })
        .promise();

      const contents = JSON.parse(object.Body.toString());
      return {
        props: { isPreview: true, snapshotId, contents },
      };
    } catch (e) {
      return {
        props: {
          isPreview: false,
          hasError: true,
          message:
            // 403 implies 404 in this case, as our IAM user has access to all
            // objects, but the bucket itself is private.
            e.statusCode === 403
              ? 'The requested preview edit does not exist!'
              : 'An error has occurred while connecting to S3. Please refresh the page to try again.',
        },
      };
    }
  }
  return { props: { isPreview: false } };
};

export default function Home(props) {
  // Scroll to top on mount as to ensure the user sees the "Preview Mode" bar
  useScrollReset();

  const [currentSnapshotId, setSnapshotId] = useState(null);
  const clearSnapshot = useCallback(() => setSnapshotId(null), [setSnapshotId]);

  const [isEdit, setEdit] = useState(false);
  const toggleEdit = useCallback(() => setEdit(!isEdit), [isEdit]);

  // Prevent duplication before re-render
  const hasSaveRequest = useRef(false);
  const [isSharingView, _setSharing] = useState(false);
  const setSharing = useCallback(
    (sharing: boolean) => {
      hasSaveRequest.current = sharing;
      _setSharing(sharing);
    },
    [hasSaveRequest, _setSharing]
  );

  const [currentError, setError] = useState<Error>(null);
  const onClearError = useCallback(() => {
    setError(null);
  }, [setError]);

  const share = useCallback(() => {
    if (hasSaveRequest.current) return;
    setSharing(true);

    const els = document.querySelectorAll('[id] > [contenteditable=true]');
    const persistContents: FieldEdit[] = [].slice
      .call(els)
      .map(({ parentNode: { id }, innerText }) => ({ id, innerText }));

    self
      .fetch(`/api/save`, {
        method: 'POST',
        body: JSON.stringify(persistContents),
        headers: { 'content-type': 'application/json' },
      })
      .then((res) => {
        if (res.ok) return res.json();
        return new Promise(async (_, reject) =>
          reject(new Error(await res.text()))
        );
      })
      .then(({ snapshotId }) => {
        setSnapshotId(snapshotId);
      })
      .catch((err) => {
        setError(err);
      })
      .finally(() => {
        setSharing(false);
      });
  }, []);

  const edits = props.isPreview ? props.contents : [];
  return (
    <>
      <Head>
        <title>Zrasti.si | Psiholo≈°ko svetovanje</title>
        <meta
          name="description"
          content="Psiholo≈°ko svetovanje vam pomaga razumeti in re≈°iti ƒçustvene, vedenjske in du≈°evne izzive. Na≈°a storitev vam nudi osebno svetovanje za izbolj≈°anje va≈°ega du≈°evnega zdravja in dobrega poƒçutja."
        ></meta>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />


      </Head>
      {currentError && (
        <ErrorDialog onExit={onClearError}>
          <p>
            An error occurred while saving your snapshot. Please try again in a
            bit.
          </p>
          <pre>{currentError.message}</pre>
        </ErrorDialog>
      )}
      {currentSnapshotId && (
        <ShareLinkDialog
          snapshotId={currentSnapshotId}
          onExit={clearSnapshot}
        />
      )}
      <div className={layoutStyles.layout}>
        {(props.isPreview || props.hasError) && (
          <aside role="alert">
            <a href="/api/exit">Preview Mode</a>
          </aside>
        )}
        {props.hasError ? (
          <>
            <h1>Oops</h1>
            <h2>Something unique to your preview went wrong.</h2>
            <div className="explanation" style={{ textAlign: 'center' }}>
              <p>
                The production website is <strong>still available</strong> and
                this does not affect other users.
              </p>
            </div>
            <hr />
            <h2>Reason</h2>
            <div className="explanation" style={{ textAlign: 'center' }}>
              <p>{props.message}</p>
            </div>
          </>
        ) : (
          <Content isEdit={isEdit} edits={edits} />
        )}
      </div>
      {isEdit ? (
        <>
          <Snapshot
            onCancel={toggleEdit}
            onShare={share}
            isSharing={isSharingView}
          />
        </>
      ) : (
        <Edit onClick={toggleEdit} />
      )}
    </>
  );
}


function Content({ isEdit, edits }: { isEdit: boolean; edits: FieldEdit[] }) {
  const [isOpen, setIsOpen] = useState(false);
  const menuRef = useRef<HTMLDivElement>(null); // Reference for the menu
  const hamburgerRef = useRef<HTMLDivElement>(null); // Reference for the hamburger icon

  const toggleMenu = () => {
    setIsOpen(!isOpen);
  };

  // Close menu when clicking outside
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      // Ignore clicks on the hamburger icon
      if (
        menuRef.current &&
        !menuRef.current.contains(event.target as Node) &&
        hamburgerRef.current &&
        !hamburgerRef.current.contains(event.target as Node)
      ) {
        setIsOpen(false); // Close the menu if the click is outside
      }
    };

    if (isOpen) {
      document.addEventListener('mousedown', handleClickOutside);
    } else {
      document.removeEventListener('mousedown', handleClickOutside);
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [isOpen]);

  return (
    <div>


      <div className={layoutStyles.contentWrapper}>
        {/* Title */}
        <Malleable id="title" as="h1" isActive={isEdit} edits={edits} className={layoutStyles.title}>
          Zrasti.si
        </Malleable>

        {/* Hamburger Icon for mobile */}
        <div ref={hamburgerRef} className={layoutStyles.hamburger} onClick={toggleMenu}>
          ‚ò∞
        </div>

        {/* Menu with anchor links */}
        <nav ref={menuRef} className={`${layoutStyles.navbar} ${isOpen ? layoutStyles.showMenu : ''}`}>
          <a href="#psiholosko-svetovanje" onClick={toggleMenu}>üß† Psiholo≈°ko svetovanje</a>
          <a href="#kontakt" onClick={toggleMenu}>üìû Kontakt</a>
        </nav>

        {/* Image Section */}
        <section className={layoutStyles.heroSection}>
          <div className={layoutStyles.imageWrapper}>
            <Image
              className={layoutStyles.frontpageImg}
              src="/Untitled_design.png" // Path to your image
              alt="Psychological Counseling"
              width={1200}
              height={610}
              layout="responsive"
              priority={true}
              sizes="(max-width: 600px) 100vw, 1200px"
            />

            <div className={layoutStyles.textOverlay}>
              <p><b>Osvobodite se stresa, tesnobe, depresije</b> in omogoƒçite pozitivne spremembe v va≈°em ≈æivljenju!</p>
              <a href="#kontakt">
                <button className={layoutStyles.button}>Rezervirajte termin</button>
              </a>

            </div>
          </div>
        </section>
        <section className={layoutStyles.introductionSection}>
          <div className={layoutStyles.cardWrapper}>
            {/* Introduction Text */}
            <div className={layoutStyles.textContent}>
              <Malleable as="h2" className={layoutStyles.subtitle}>
                Dobrodo≈°li!
              </Malleable>
              <p className={layoutStyles.paragraph}>
                Spletna stran <strong>Zrasti.si</strong> je tukaj za <strong>vas, va≈°o osebno rast in preobrazbo</strong>. Ne glede na to, s kak≈°nimi izzivi ali te≈æavami se trenutno sooƒçate, skupaj jih bomo premagali. Iz izku≈°enj sem se nauƒçila, da je kljuƒç do trajnih sprememb v ≈æivljenju ravnovesje med osebno preobrazbo in praktiƒçnim delom.
              </p>
              <div style={{ display: 'block' }}>
              <span className={layoutStyles.imageWrapper2} style={{ float: 'right', margin: '0 0 10px 10px' }}>
      <Image
        className={layoutStyles.frontpageImg}
        src="/fears.png"
        alt="source: https://www.flaticon.com/free-stickers/ability"
        width={140} // Adjust the width for mobile
        height={140}
      />
    </span>
  </div>
              <p className={layoutStyles.paragraph}>
                <strong>Zaslu≈æite si svobodo in sreƒço</strong>, in tukaj sem, da vas podpiram in vodim na tej poti, korak za korakom. S pomoƒçjo mojega znanja, tehnik in orodij vam bom pomagala <strong>odkriti, kdo v resnici ste in kak≈°en je va≈° potencial v ≈æivljenju</strong>.
              </p>
           

            </div>
          </div>
        </section>

        {/* Downloadable Resources */}
        <section id="brezplacne-vsebine">
          <div className={layoutStyles.downloadSection}>
            <Malleable as="h2" isActive={isEdit} edits={edits} className={layoutStyles.subtitle}>
              Brezplaƒçne vsebine
            </Malleable>
            <p className={layoutStyles.paragraph}>
              Za vas sem pripravila delovne zvezke, ki jih lahko prenesete s klikom na spodnji gumb.
            </p>
            <a href="/Krepitev_obcutka_lastne_vrednosti.pdf" className={layoutStyles.downloadButton} download>
              Prenesi
            </a>
          </div>
        </section>


        {/* Psiholo≈°ko svetovanje Section */}
        <section id="psiholosko-svetovanje" className={layoutStyles.psiholoskoSection}>
          <Malleable as="h2" isActive={isEdit} edits={edits} className={layoutStyles.subtitle}>
            Kaj je psiholo≈°ko svetovanje?
          </Malleable>

          
          <p className={layoutStyles.paragraph}>
            Je oblika pogovorne terapije, kjer obravnavamo va≈°e <strong>aktualne psihiƒçne te≈æave in stiske. </strong>
            Cilj je, da vam pomagam do <strong>bolj kakovostnega ≈æivljenja</strong>, bolj≈°ega ƒçustvovanja, vedenja, bolj≈°ega odnosa do sebe in drugih ter <strong>bolj≈°ega funkcioniranja</strong>. Psiholo≈°ko svetovanje izvajamo psihologi, z ustreznim znanje za tak≈°no delo.
           
            <div style={{ display: 'block' }}>
    
    <span className={layoutStyles.imageWrapper2} style={{ float: 'right', margin: '0 0 10px 10px' }}>
      <Image
        className={layoutStyles.frontpageImg}
        src="/brains.png"
        alt="source: https://www.flaticon.com/free-stickers/help"
        width={140} // Adjust the width for mobile
        height={140}
      />
    </span>
  </div>
            <p>
              Psiholo≈°ko svetovanje je primerno za vas, ƒçe:
            </p>


            <ul>
              <li>se sooƒçate z <strong>zmerno ƒçustveno stisko</strong></li>
              <li>ste pod <strong>stresom</strong></li>
              <li>imate konkreten <strong>problem</strong>, za katerega sami niste na≈°li zadovoljive re≈°itve</li>
              <li>≈æelite izbolj≈°ati <strong>odnos do sebe in drugih</strong></li>
              <li>≈æelite razumeti svoja <strong>ƒçustva, vedenje in funkcioniranje</strong></li>
            </ul>
            <p className={layoutStyles.paragraph}>
              Vƒçasih pa te≈æave presegajo okvire psiholo≈°kega svetovanja, zato vas takrat usmerim v poglobljeno psihoterapevtsko obravnavo.
            </p>
          </p>
        </section>

        {/* Online psiholo≈°ko svetovanje Section */}
        <section id="online-psiholosko-svetovanje" className={layoutStyles.psiholoskoSection}>
          <Malleable as="h2" isActive={isEdit} edits={edits} className={layoutStyles.subtitle}>
            Kaj pa je online psiholo≈°ko svetovanje?
          </Malleable>
          

          <div style={{ display: 'block' }}>
          <span className={layoutStyles.imageWrapper2} style={{ float: 'right', margin: '0 0 10px 10px' }}>
      <Image
        className={layoutStyles.frontpageImg}
        src="/communication.png"
        alt="source: https://www.flaticon.com/free-stickers/online-meeting"
        width={140} // Adjust the width for mobile
        height={140}  
        />
    </span>
  </div>
          <p className={layoutStyles.paragraph}>
            Online psiholo≈°ko svetovanje poteka enako kot obiƒçajno svetovanje, le da se izvaja preko videoklica ali telefonskega klica, glede na va≈°e ≈æelje.
            <p>≈†e nekaj let nazaj, pred zaƒçetkom pandemije, je bilo svetovanje in psihoterapija prek spleta precej tuj in nov koncept pri nas. Zaradi pandemije pa smo se bili prisiljeni navaditi na ta nov naƒçin delovanja sveta.</p>
            <p>In ≈°e dobro! Obstaja veliko razlogov, zakaj se je e-terapija tako razmahnila, in zakaj bo v prihodnje ≈°e bolj ustaljen in uƒçinkovit naƒçin pomoƒçi, npr.:</p>
            <h4>1. DOSTOPNOST</h4>
            <p>
              Ni se vam potrebno peljati nikamor in zapravljati dodatnega denarja za gorivo in parkirnine; priroƒçna za gibalno ovirane osebe; priroƒçno, ƒçe je va≈°e razpolo≈æenje zni≈æano in nimate motivacije za odhod iz hi≈°e; dostopnost kvalitetne terapije ne glede na lokacijo, ne glede na to, ali ≈æivite v odroƒçnemu kraju ali velikemu mestu, ali drugi dr≈æavi.
            </p>
            <h4>2. ƒåAS</h4>
            <p>
              Prihranite veliko dragocenega ƒçasa, ker se izognete vo≈ænji in gneƒçi na cesti.
            </p>
            <h4>3. ZASEBNOST</h4>
            <p>
              Popolna diskretnost, saj vam ni potrebno skrbeti, da boste sreƒçali znanca v ƒçakalnici. Nekatere teme vam bo morda la≈æje odpreti in se o njih pogovoriti v okolju, kjer se vi poƒçutite najbolj spro≈°ƒçene.
            </p>
            <h4>4. DOMAƒåE OKOLJE</h4>
            <p>
              Razkrivanje ranljivih delov sebe je te≈æko. V poznanem, domaƒçem okolju bo morda za vas ta proces znatno la≈æji. Pogovor o te≈æjih temah je lahko la≈æji skozi ekran kot pa v ≈æivo. Morda boste najbolj spro≈°ƒçeni na va≈°em kavƒçu v udobni trenirki s ƒçajem in odejico üòäitd...
            </p>
          </p>

        </section>


{/* Online psiholo≈°ko svetovanje Section */}
<section id="cas-za-spremembo" className={layoutStyles.psiholoskoSection}>
  <Malleable as="h2" isActive={isEdit} edits={edits} className={layoutStyles.subtitle}>
    ALI JE ƒåAS ZA SPREMEMBO?
  </Malleable>
  
  <div style={{ display: 'block' }}>
    <p className={layoutStyles.paragraph}>
      Zjutraj se zbudite in se pretvarjate, da so stvari 'v redu'. Pa niso. Do zdaj vam ≈°e niƒç ni zares pomagalo, da bi stvari spremenili na bolje.
    </p>
    
    <span className={layoutStyles.imageWrapper2} style={{ float: 'right', margin: '0 0 10px 10px' }}>
      <Image
        className={layoutStyles.frontpageImg}
        src="/mental-health.png"
        alt="source: https://www.flaticon.com/free-stickers/stress"
        width={140} // Adjust the width for mobile
        height={140}
      />
    </span>
  </div>



          <p className={layoutStyles.paragraph}>
            Zanima me, ali:

            <ul>
              <li>Se veƒçkrat poƒçutite nesreƒçne?</li>
              <li>Pogosto ƒçutite strah, jezo, krivdo?</li>
              <li>Se poƒçutite osamljene in izolirane?</li>
              <li>Ste pogosto napeti, zaskrbljeni, tesnobni?</li>
              <li>Ste pod stresom?</li>
              <li>Se vam zdi, da ste obstali na neki toƒçki v ≈æivljenju in ne znate naprej?</li>
              <li>Imate pomanjkanje motivacije?</li>
              <li>Je va≈°e razpolo≈æenje zni≈æano?</li>
              <li>Imate obƒçutek, da ne veste, kdo v resnici ste, kaj si ≈æelite in ƒçesa ste sposobni?</li>
              <li>V va≈°em slovarju ne obstaja beseda NE, saj ≈æelite vsem ugajati?</li>
              <li>Va≈°e ƒçustveno stanje vpliva na vsakodnevno funkcioniranje: zdravje, slu≈æba, medosebni odnosi‚Ä¶?</li>
              <li>Se samosabotirate?</li>
              <li>Si te≈æko postavljate in dosegate cilje?</li>
              <li>Se te≈æko sooƒçate s spremembami v ≈æivljenju?</li>
            </ul>

            <p>
              Ste se na≈°li v enem ali veƒç zgornjih vpra≈°anj ali pa se domislili kak≈°nega podobnega? Odliƒçno! In pohvale, da ste iskreni s sabo.
              Morda ste zdaj prviƒç opazili, da se pojavljajo te≈æave na doloƒçenih podroƒçjih, morda pa ste ≈æe veliko ƒçasa namenili razmi≈°ljanju o tem, kaj v va≈°em ≈æivljenju ne deluje.
              Prvi korak je vedno, da <strong>ozavestimo</strong> to, kar ≈æelimo spremeniti.
              <br />
              Tako, zdaj ste pripravljeni na naslednji korak: <strong>SPREMEMBO</strong>.
              <br />
              Tukaj sem jaz, da vas spremljam na poti preobrazbe. Moj cilj je, da vas opolnomoƒçim, razbremenim ƒçustvene stiske in da vam omogoƒçim nove in moƒçne "aha" trenutke.
            </p>
          </p>
          <div style={{ display: 'block' }}>
              <span className={layoutStyles.imageWrapper2} style={{ float: 'right', margin: '0 0 10px 10px' }}>
      <Image
        className={layoutStyles.frontpageImg}
        src="/brains2.png"
        alt="source: https://www.flaticon.com/free-stickers/ability"
        width={140} // Adjust the width for mobile
        height={140}
      />
    </span>
  </div>
        </section>
        {/* Po svetovanju Section */}
        <section id="cas-za-spremembo" className={layoutStyles.psiholoskoSection}>
          <Malleable as="h2" isActive={isEdit} edits={edits} className={layoutStyles.subtitle}>
            Po svetovanju
          </Malleable>
          <p className={layoutStyles.paragraph}>
            Po svetovanju boste lahko opazili:

            <ul>
              <li>da se zavedate lastne vrednosti, si znate prisluhniti in se postaviti na prvo mesto</li>
              <li>da si zaupate in vas mnenja drugih ne ganejo preveƒç</li>
              <li>da ste v stiku s sabo, veste, kaj si ≈æelite in kaj potrebujete, in to z lahkoto izra≈æate</li>
              <li>da razvijete soƒçuten, ne≈æen in potrpe≈æljiv odnos do sebe, ki vam bo prinesel svobodo, bolj≈°o samopodobo in moƒçno samozavest</li>
              <li>da imate veƒçji obƒçutek moƒçi, varnosti in stabilnosti ne glede na to, kaj se dogaja</li>
              <li>da imate jasno vizijo, kaj si v ≈æivljenju ≈æelite in na kak≈°en naƒçin to doseƒçi</li>
              <li>da vsakodnevne te≈æave re≈°ujete la≈æje in z manj napora</li>
              <li>da se la≈æje odloƒçate</li>
              <li>da ste bolj zadovoljni, mirni, sreƒçni</li>
            </ul>
          </p>
        </section>


        <hr></hr>

        {/* Kontakt Section */}
        <section id="kontakt">
          <Malleable as="h2" isActive={isEdit} edits={edits} className={layoutStyles.subtitle}>
            Kontakt
          </Malleable>
          <p className={layoutStyles.paragraph}>
            Za veƒç informacij ali rezervacijo termina me lahko kontaktirate:
          </p>
          <span className={layoutStyles.paragraph}>üìß Email: </span>
          <span className={layoutStyles.paragraph}>
            <a href='mailto:zrasti.si@gmail.com'>zrasti.si@gmail.com</a>
          </span>
          <div></div>
          <span className={layoutStyles.paragraph}>üìû Telefon:
          </span>
          <span className={layoutStyles.paragraph}>
            <a href='tel:+386 70 646 775'> +386 70 646 775</a>
          </span>
        </section>



      </div>

      <section className={layoutStyles.footer}>
        <div className={layoutStyles.footerContent}>
          <p>
            ¬© 2024, Zrasti.si
          </p>
          <p>
            <a href="mailto:zrasti.si@gmail.com">zrasti.si@gmail.com</a>
            <br />
            <a href="tel:+386 70 646 775">+386 70 646 775</a>
          </p>
        </div>

        <div className={layoutStyles.socialIcons}>
          <a href="https://www.facebook.com/zrasti.si" aria-label="Facebook" target="_blank" rel="noreferrer">
            <i className="fab fa-facebook-f"></i>
          </a>
          <a href="https://www.instagram.com/zrasti.si/" aria-label="Instagram" target="_blank" rel="noreferrer">
            <i className="fab fa-instagram"></i>
          </a>
        </div>
      </section>



    </div>

  );
}

